.PHONY: help build run test install-deps install-chromium clean

help: ## Mostra esta ajuda
	@echo "ğŸ“‹ Comandos disponÃ­veis:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-20s\033[0m %s\n", $$1, $$2}'

build: ## Compila o projeto
	@echo "ğŸ”¨ Compilando..."
	go build -o go-lead main.go
	@echo "âœ… Compilado com sucesso!"

run: ## Executa o programa (use: make run ARGS="nome empresa cnpj")
	@go run main.go $(ARGS)

test: ## Roda os testes
	@echo "ğŸ§ª Executando testes..."
	go test ./...

install-deps: ## Instala dependÃªncias do Go
	@echo "ğŸ“¦ Instalando dependÃªncias..."
	go mod download
	go mod tidy
	@echo "âœ… DependÃªncias instaladas!"

install-chromium: ## Instala Chromium (necessÃ¡rio para ChromeDP em servidores)
	@echo "âš ï¸  ATENÃ‡ÃƒO: ChromeDP requer Chromium instalado!"
	@echo ""
	@echo "ğŸ§ Para Ubuntu/Debian:"
	@echo "  sudo apt-get update"
	@echo "  sudo apt-get install -y chromium-browser"
	@echo ""
	@echo "ğŸ© Para Fedora/RHEL:"
	@echo "  sudo dnf install -y chromium"
	@echo ""
	@echo "ğŸ Para MacOS:"
	@echo "  brew install chromium"
	@echo ""
	@echo "ğŸ‹ Para Docker, adicione ao Dockerfile:"
	@echo "  RUN apt-get update && apt-get install -y chromium-browser"
	@echo ""
	@read -p "Deseja instalar agora? [s/N] " confirm; \
	if [ "$$confirm" = "s" ] || [ "$$confirm" = "S" ]; then \
		if command -v apt-get > /dev/null; then \
			sudo apt-get update && sudo apt-get install -y chromium-browser; \
		elif command -v dnf > /dev/null; then \
			sudo dnf install -y chromium; \
		else \
			echo "âŒ Sistema nÃ£o suportado. Instale manualmente."; \
		fi \
	fi

clean: ## Remove arquivos compilados
	@echo "ğŸ§¹ Limpando..."
	rm -f go-lead
	@echo "âœ… Limpeza concluÃ­da!"

server-setup: ## Guia de setup para servidor
	@echo "ğŸ–¥ï¸  SETUP EM SERVIDOR (PRODUÃ‡ÃƒO)"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "1ï¸âƒ£  Instalar Go (se nÃ£o estiver instalado):"
	@echo "   wget https://go.dev/dl/go1.24.0.linux-amd64.tar.gz"
	@echo "   sudo tar -C /usr/local -xzf go1.24.0.linux-amd64.tar.gz"
	@echo "   export PATH=\$$PATH:/usr/local/go/bin"
	@echo ""
	@echo "2ï¸âƒ£  Clonar o projeto:"
	@echo "   git clone <seu-repo>"
	@echo "   cd go-lead"
	@echo ""
	@echo "3ï¸âƒ£  Instalar dependÃªncias:"
	@echo "   make install-deps"
	@echo ""
	@echo "4ï¸âƒ£  âš ï¸  IMPORTANTE: Instalar Chromium (SE usar ChromeDP):"
	@echo "   make install-chromium"
	@echo "   # OU manualmente:"
	@echo "   sudo apt-get install -y chromium-browser"
	@echo ""
	@echo "5ï¸âƒ£  Compilar:"
	@echo "   make build"
	@echo ""
	@echo "6ï¸âƒ£  Executar:"
	@echo "   ./go-lead \"nome empresa cnpj\""
	@echo ""
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "ğŸ’¡ NOTA: DuckDuckGo e Sites de Consulta NÃƒO precisam"
	@echo "    de Chromium. Apenas se descomentar ChromeDP!"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

# Atalhos Ãºteis
dd: ## Testa com DuckDuckGo (exemplo: make dd QUERY="dimazzo arapongas cnpj")
	@go run main.go $(QUERY)

rate-limit-test: ## Testa rate limit do DuckDuckGo
	@go run test_rate_limit.go

process-list: ## Processa lista de empresas (use: make process-list FILE=empresas.txt)
	@if [ -z "$(FILE)" ]; then \
		echo "âŒ Erro: especifique o arquivo com FILE=nome.txt"; \
		echo "Exemplo: make process-list FILE=empresas.txt"; \
		exit 1; \
	fi
	@go run process_list.go $(FILE)

process-list-safe: ## Processa lista com RETRY e salvamento contÃ­nuo (RECOMENDADO)
	@if [ -z "$(FILE)" ]; then \
		echo "âŒ Erro: especifique o arquivo com FILE=nome.txt"; \
		echo "Exemplo: make process-list-safe FILE=empresas.txt"; \
		exit 1; \
	fi
	@go run process_list_safe.go $(FILE)

exemplo-lista: ## Processa arquivo de exemplo (versÃ£o rÃ¡pida)
	@echo "âš ï¸  Usando versÃ£o rÃ¡pida. Para versÃ£o SEGURA use: make exemplo-lista-safe"
	@go run process_list.go empresas_exemplo.txt

exemplo-lista-safe: ## Processa arquivo de exemplo (versÃ£o SEGURA - RECOMENDADO)
	@echo "âœ… Usando versÃ£o SEGURA com retry e salvamento contÃ­nuo"
	@go run process_list_safe.go empresas_exemplo.txt
